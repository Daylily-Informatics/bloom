{
  "name": "Turnaround Time Monitor",
  "description": "Dashboard for monitoring sample and workflow turnaround times with SLA compliance",
  "version": "1.0",
  "refresh_interval": "15 minutes",
  "layout": {
    "rows": 3,
    "columns": 4
  },
  "cards": [
    {
      "id": "avg_tat_today",
      "title": "Avg TAT Today (hours)",
      "type": "scalar",
      "position": {"row": 1, "col": 1, "width": 1, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "aggregation": "avg",
        "column": "mean_tat_hours",
        "filters": [
          {"column": "start_date", "operator": "=", "value": "CURRENT_DATE"}
        ]
      },
      "visualization": {
        "type": "number",
        "decimals": 1,
        "suffix": "h"
      }
    },
    {
      "id": "sla_compliance",
      "title": "48h SLA Compliance",
      "type": "scalar",
      "position": {"row": 1, "col": 2, "width": 1, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "aggregation": "avg",
        "column": "sla_48h_compliance_pct",
        "filters": [
          {"column": "start_date", "operator": ">=", "value": "CURRENT_DATE - 7"}
        ]
      },
      "visualization": {
        "type": "number",
        "decimals": 1,
        "suffix": "%",
        "goal": 95,
        "show_goal": true
      }
    },
    {
      "id": "p95_tat",
      "title": "P95 TAT (hours)",
      "type": "scalar",
      "position": {"row": 1, "col": 3, "width": 1, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "aggregation": "avg",
        "column": "p95_tat_hours",
        "filters": [
          {"column": "start_date", "operator": ">=", "value": "CURRENT_DATE - 7"}
        ]
      }
    },
    {
      "id": "completed_today",
      "title": "Completed Today",
      "type": "scalar",
      "position": {"row": 1, "col": 4, "width": 1, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "aggregation": "sum",
        "column": "completed_count",
        "filters": [
          {"column": "start_date", "operator": "=", "value": "CURRENT_DATE"}
        ]
      }
    },
    {
      "id": "tat_trend",
      "title": "TAT Trend (Last 30 Days)",
      "type": "timeseries",
      "position": {"row": 2, "col": 1, "width": 2, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "columns": ["start_date", "mean_tat_hours", "median_tat_hours", "p95_tat_hours"],
        "filters": [
          {"column": "start_date", "operator": ">=", "value": "CURRENT_DATE - 30"}
        ],
        "order_by": [{"column": "start_date", "direction": "asc"}]
      },
      "visualization": {
        "type": "line",
        "x_axis": "start_date",
        "y_axes": ["mean_tat_hours", "median_tat_hours", "p95_tat_hours"],
        "colors": ["#3b82f6", "#22c55e", "#f59e0b"]
      }
    },
    {
      "id": "sla_distribution",
      "title": "SLA Distribution",
      "type": "chart",
      "position": {"row": 2, "col": 3, "width": 2, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "columns": ["within_24h", "within_48h", "within_72h"],
        "aggregation": {"function": "sum"},
        "filters": [
          {"column": "start_date", "operator": ">=", "value": "CURRENT_DATE - 30"}
        ]
      },
      "visualization": {
        "type": "bar",
        "stacked": true
      }
    },
    {
      "id": "tat_by_type",
      "title": "TAT by Sample Type",
      "type": "table",
      "position": {"row": 3, "col": 1, "width": 4, "height": 1},
      "query": {
        "source_table": "v_turnaround_times",
        "columns": ["item_type", "item_subtype", "completed_count", "mean_tat_hours", "median_tat_hours", "p95_tat_hours", "sla_48h_compliance_pct"],
        "aggregation": {"function": "avg", "group_by": ["item_type", "item_subtype"]},
        "filters": [
          {"column": "start_date", "operator": ">=", "value": "CURRENT_DATE - 30"}
        ],
        "order_by": [{"column": "mean_tat_hours", "direction": "desc"}],
        "limit": 20
      },
      "visualization": {
        "type": "table",
        "conditional_formatting": {
          "column": "sla_48h_compliance_pct",
          "rules": [
            {"condition": "< 80", "color": "#ef4444"},
            {"condition": "< 95", "color": "#f59e0b"},
            {"condition": ">= 95", "color": "#22c55e"}
          ]
        }
      }
    }
  ]
}

