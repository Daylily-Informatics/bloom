<!DOCTYPE html>
<html>
    <head>

        {% set page_title = 'Bloom Login' %}
        <title>{{ page_title }}</title>

        <link rel="stylesheet" type="text/css" href="{{ style.skin_css }}"  >
        <link rel="stylesheet" type="text/css" href="static/style.css">
<script>
    function validateEmail(email) {
        try {
            const re = /^(([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        } catch (error) {
            console.error("Email validation error:", error);
            alert('An error occurred during email validation. Please try again.');
            return false;
        }
    }

    function validateForm() {
        try {
            var email = document.getElementById('email').value;
            if (!validateEmail(email)) {
                alert('Please enter a valid email address.');
                return false;
            }
            return true;
        } catch (error) {
            console.error("Form validation error:", error);
            document.getElementById('error-message').innerText = 'An error occurred. Please try again.';
            return false;
        }
    }

    function validateFormNoNetwork() {
        try {
            var emailwithoutnetwork = document.getElementById('emailwithoutnetwork').value;
            if (!validateEmail(emailwithoutnetwork)) {
                alert('Please enter a valid email address.');
                return false;
            }
            return true;
        } catch (error) {
            console.error("Form validation without network error:", error);
            document.getElementById('error-message-no-network').innerText = 'An error occurred. Please try again.';
            return false;
        }
    }

    function handleGitHubLogin() {
        try {
            window.location.href = 'https://kslpzwcmkyrbxqmlhgln.supabase.co/auth/v1/authorize?provider=github&scope=user:email';
        } catch (error) {
            console.error("GitHub login error:", error);
            alert('An error occurred while attempting to log in with GitHub. Please try again.');
        }
    }

    function handleGoogleLogin() {
        try {
            window.location.href = 'https://kslpzwcmkyrbxqmlhgln.supabase.co/auth/v1/authorize?provider=google&userinfo.email';
        } catch (error) {
            console.error("Google login error:", error);
            alert('An error occurred while attempting to log in with Google. Please try again.');
        }
    }
</script>

    </head>
    <body>
        {% include 'bloom_header.html' %}

        <ul><li><a href=/logout>LOGOUT</a></ul>
        <div id="error-message" style="color: red;"></div> <!-- Error message display -->
        <ul><hr><ul>
            <br><h3> Login w/Github or Google (this requires config! see docs)</h3><ul>
                
            <button onclick="handleGitHubLogin()">Login with GitHub</button>
            <button onclick="handleGoogleLogin()">Login with Gmail</button>
        </ul></ul></ul>
  <hr>
        <div id="error-message-no-network" style="color: red;"></div> <!-- Error message display for no network form -->
        <ul><hr><ul>
            <h2>Login Form without internet connection</h2>
            <br><h3> Login or Signup with your Email To Begin A Bloom Session</h3><ul>
                <form method="post" action="/login" onsubmit="return validateFormNoNetwork()">
                    <label for="emailwithoutnetwork">Email:</label>
                    <input type="text" id="emailwithoutnetwork" name="email">
                    <br>
                    <label for="pwd">Password Not Required At This Time</label> 
                    <input value='notapplicable' type="hidden" id="password" name="password">
                    <br>
                    <input type="submit" value="Login">
                </form>
        </ul></ul></ul>
    </body>
</html>
