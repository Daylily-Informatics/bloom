{% extends 'includes/base.html' %}
{% set page_title = 'Admin' %}
{% set bloom_mod = 'admin' %}

{% block extra_head %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
    </style>
    <script>
        $(document).ready(function() {
            {% if dest_section.section == 'skin' %}
                $('#skin-css-section').addClass('flash-effect');
            {% elif dest_section.section == 'zebra' %}
                $('#zebra-css-section').addClass('flash-effect');
            {% elif dest_section.section == 'template' %}
                $('#template-css-section').addClass('flash-effect');
            {% endif %}
        });
    </script>
{% endblock %}

{% block content %}
    <br>
<ul>
    <h2>Dewey Administration</h2>
    <ul><small><a href="/user_home">user preferences may be edited here</a></small></ul>
        <hr>
        <ul>

    <h2><a href="/bloom_schema_report"> Schema Summary Statistics</a> </h2>

    

    <h2> <a href="/object_templates_summary">All Instantiable Templates Loaded Into The Database (not for operational use)</h2></a>


    <h2>
        <a style="display: none;" href="/workflow_summary">Original Raw Workflow View (not intended for operational use)</a>
    </h2>

    <div id="backup-section">
        <h3>Database Backups</h3>
        <table>
            <tr>
                <td>Backup Directory:</td>
                <td>
                    <input type="text" value="{{ user_data.get('db_backup_path', './db_backups') }}" onchange="updatePreferenceAndReload('db_backup_path', this.value)">
                    <form method="post" action="/db_backup" style="display:inline;">
                        <button type="submit">Dump Backup</button>
                    </form>
                </td>
            </tr>
        </table>

        {% if backups %}
        <table border="1">
            <tr><th>Backup File</th><th>Action</th></tr>
            {% for b in backups %}
            <tr>
                <td>{{ b }}</td>
                <td>
                    <form method="post" action="/db_restore" onsubmit="return confirm('Restore from {{ b }}? This will overwrite the current database.');">

                        <input type="hidden" name="filename" value="{{ b }}">
                        <button type="submit">Restore</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>No backups found in {{ backup_path }}</p>
        {% endif %}
    </div>
    {% include 'includes/update_preference_script.html' %}
{% endblock %}
