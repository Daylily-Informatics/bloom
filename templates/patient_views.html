<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{{ style.skin_css }}">
    <link rel="stylesheet" type="text/css" href="static/style.css">
    {% set page_title = 'Patient Views' %}
    <title>{{ page_title }}</title>
    {% set bloom_mod = 'exploratory' %}
</head>
<body>
    {% include 'bloom_header.html' %}

p    {{ patient_id }}
    <br>
pp    {{ patient_ids}}
<br>
xx
                            {% for field in ui_fields %}
                                {% if field.name == 'import_or_remote' %}
                                <div id="import_or_remote_container" style="display:none;">
                                    <label for="{{ field.name }}">{{ field.label }}</label>
                                    <select name="{{ field.name }}" id="{{ field.name }}" class="select-filter">
                                        <option value="" selected></option>
                                        {% for option in field.options %}
                                            <option value="{{ option }}">{{ option }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                {% else %}
                                <div>
                                    {% if field.type == "select" %}
                                        {% if field.name == "creating_user" %}

                                        {% else %}
                                        <label for="{{ field.name }}">{{ field.label }}</label>

                                        <select name="{{ field.name }}" id="{{ field.name }}" class="select-filter">
                                            <option value="" selected></option> <!-- Placeholder for blank state -->
                                            {% for option in field.options %}
                                                <option value="{{ option }}">{{ option }}</option>
                                            {% endfor %}
                                        </select>
                                        {% endif %}
                                    {% else %}
                                    <label for="{{ field.name }}">{{ field.label }}</label>

                                        {% if field.name.endswith('record_datetime')  %}
                                                
                                                <!-- Date and Time Selectors -->
                                                <input type="date" id="custom-date-start" name="custom-date-start" pattern="\d{2}-\d{2}-\d{4}" placeholder="MM-DD-YYYY">
                                                <label for="custom-date-start"> time:</label>
                                                                                        
                                                <input type="time" id="custom-time-start" name="custom-time-start"  placeholder="--:--:--">
                                                

                                                <!-- Hidden Merged Field -->
                                                <input type="hidden" id="record_datetime" name="record_datetime">

                                        {% elif field.name.endswith('record_datetime_end')  %}
                                                <!-- Date and Time Selectors -->
                                                <input type="date" id="custom-date-end" name="custom-date-end" pattern="\d{2}-\d{2}-\d{4}" placeholder="MM-DD-YYYY">
                                                <label for="custom-time-end"> time:</label>
                                                
                                                <input type="time" id="custom-time-end" name="custom-time-end" placeholder="--:--:--">

    
                                                <!-- Hidden Merged Field -->
                                                <input type="hidden" id="record_datetime_end" name="record_datetime_end">

                                        {% elif field.name.endswith('_date') %}
                                            <input type="date" name="{{ field.name }}" id="{{ field.name }}" />
                                        {% elif field.name.endswith('_break') %}
                                    </ul><hr><ul>
                                        {% else %}
                                            <input type="{{ field.type }}" name="{{ field.name }}" id="{{ field.name }}" />
                                        {% endif %}
                                    {% endif %}
                                </div>
                                {% endif %}
                            {% endfor %}

                            zz
                            <br>

    <small><a href="dindex2">(graph)</a></small> <small><a href="/">(B)</a></small>

    <h1>Patient Views</h1>
    <form method="get" action="/patient_views">
        <label for="patient_id">Select Patient:</label>
        <select name="patient_id" id="patient_id" onchange="this.form.submit()">
            <option value="">-- choose --</option>
            {% for pid in patient_ids %}
            <option value="{{ pid }}" {% if pid == patient_id %}selected{% endif %}>{{ pid }}</option>
            {% endfor %}
        </select>
        <noscript><button type="submit">Go</button></noscript>
    </form>

    {% if patient_id %}
    <h2>Files for {{ patient_id }}</h2>
    <div>
        Sort:
        <a href="?patient_id={{ patient_id }}&sort_by=created">by db creation</a> |
        <a href="?patient_id={{ patient_id }}&sort_by=record">by record start</a>
    </div>
    <table>
        <tr><th>EUID</th><th>Created</th><th>Record Start</th><th>Purpose</th></tr>
        {% for file in files %}
        <tr style="background-color: {{ color_map.get(file.euid, '#222') }};">
            <td><a href="euid_details?euid={{ file.euid }}">{{ file.euid }}</a></td>
            <td>{{ file.created_dt.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            <td>{{ file.json_addl['properties'].get('record_datetime','') }}</td>
            <td>{{ file.json_addl['properties'].get('purpose','') }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}
</body>
</html>
